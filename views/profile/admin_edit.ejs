<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <script>
      const get_visibility = (visibility) => {
        switch(visibility) {
          case 0:
            return "Private";
          case 1:
            return "Registered users";
          case 2:
            return "Public";
        }
      }
    </script>
  </head>
  <body>
    <% if(error) { %>
      <h1 style="color:red"> Error: <%= error_message %> </h1>
    <% } %>
    <h1 style="color: red">Editing another user's profile</h1>

    <form action="/profile/<%=user.id%>/admin/?_method=PUT" method="post" id="form", enctype="multipart/form-data">

      <input type="hidden" name="_method" value="PUT"> 

      <div>
        <label for="username">Change username:</label>
        <input type="text" id="username" name="username" value="<%= user.username %>" required>
      </div>

      <div>
        <h2>Change user's password:</h2>
        <label for="new_password">New password</label>
        <input type="password" id="new_password" name="new_password" value="">
      </div>

      <div>
        <h2>Administrator privileges</h2>
        <label for="is_admin">Admin status</label>
        <% console.log("IS USER ADMIN?", user.is_admin) %>
        <input type="checkbox" id="is_admin" name="is_admin" value="true" <%= user.is_admin ? "checked" : "" %>>
      </div>

      <div>
        <h2>Profile picture</h2>
        <label for="picture">Change profile picture</label>
        <input type="file" id="picture" name="picture" value="/<%= user.path_to_avatar %>">
      </div>  

      <div>
        <h2>Profile visibility</h2>
        <select id="visibility" name="visibility">
          <option value="private" <%= user.visibility === 0 ? 'selected' : '' %>>Private</option>
          <option value="registered" <%= user.visibility === 1 ? 'selected' : '' %>>Registered users</option>
          <option value="public" <%= user.visibility === 2 ? 'selected' : '' %>>Public</option>
        </select>
      </div>

      <button type="submit">Update Profile</button>
    </form>

    <hr>

    <h2 style="color: red">Delete profile</h2>
    <form action="/profile/<%=user.id%>/?_method=DELETE" method="post" id="delete_user_form" name="delete_user_form">
      <input type="hidden" name="_method" value="DELETE"> 
      <input type="button" style="color: red" onclick="delete_user()" value="Delete Profile">
    </form>

    <a href="/profile/<%= user.id %>">Cancel</a>

    <script>
      function delete_user() {
        let r = confirm("Are you sure you want to delete this user?");
        if (r == true) {
          document.getElementById("delete_user_form").submit();
        }
      }
    </script>
  </body>
</html>


